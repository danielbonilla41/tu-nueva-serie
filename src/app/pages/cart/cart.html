<div class="cart-container">
    <h2>Carrito de Compras</h2>

    @if (shoppingCart().length === 0) {
    <div class="empty-cart-message">
        <p>Tu carrito estÃ¡ vacÃ­o. Â¡Agrega una plataforma para comenzar!</p>
        <p>ðŸ›’</p>
    </div>
    } @else {

    @if (shoppingCart().length === 1) {
    <div class="discount-alert-message discount-hierarchy">
        <p>Â¡Solo tienes una cuenta! Agrega mÃ¡s para obtener un descuento:</p>
        <ul>
            <li>2 cuentas: 5% de descuento</li>
            <li>3 cuentas: 7% de descuento</li>
            <li>4 o mÃ¡s cuentas: 10% de descuento mÃ¡ximo</li>
        </ul>
    </div>
    } @else if (shoppingCart().length === 2) {
    <div class="discount-alert-message">
        <p>Â¡Ya tienes un {{ displayDiscountPercentage() }}% de descuento! Agrega una cuenta mÃ¡s y sube al 7%.</p>
        <p>Ã“ agrega 2 cuentas mÃ¡s y sube al 10%.</p>
    </div>
    } @else if (shoppingCart().length === 3) {
    <div class="discount-alert-message">
        <p>Â¡Tienes un {{ displayDiscountPercentage() }}% de descuento! Agrega una cuenta mÃ¡s para el 10% mÃ¡ximo.</p>
    </div>
    }
    <div class="cart-list">
        @for (item of shoppingCart(); track item.name) {
        <div class="cart-item">
            <img [src]="item.iconUrl" [alt]="item.name + ' Logo'" class="item-icon">
            <div class="item-details">
                <h4>{{ item.name }}</h4>
            </div>
            <span class="item-price">
                {{ item.price | currency:'$':'symbol':'1.0-0' }}
            </span>
            <button class="remove-button" (click)="removeFromCart(item)" title="Eliminar {{ item.name }}">
                &times; </button>
        </div>
        }
    </div>

    <div class="cart-summary">
        <p>Subtotal: <span>{{ subtotal() | currency:'$':'symbol':'1.0-0' }}</span></p>

        @if (hasDiscount()) {
        <p class="discount-line">
            Descuento ({{ displayDiscountPercentage() }}%):
            <span class="discount-value">- {{ discountAmount() | currency:'$':'symbol':'1.0-0' }}</span>
        </p>
        }

        <p class="total-line">
            Total a Pagar:
            <span>{{ total() | currency:'$':'symbol':'1.0-0' }}</span>
        </p>

        <button class="checkout-button" (click)="openPaymentModal()">Finalizar Compra</button>
    </div>
    }
</div>

<!-- Modal de pago -->
@if (showModal) {
<div class="modal-overlay" (click)="closePaymentModal()">
    <div class="modal" (click)="$event.stopPropagation()">
        <button class="cerrar" (click)="closePaymentModal()">âœ•</button>

        <div class="qr-section">
            <h4>Nequi o Bre-B</h4>
            <img src="qr/nequi.png" alt="QR Nequi" class="qr">

            <div class="info">
                <span>NÃºmero: 312 583 3369</span>
                <button class="btn-copy" (click)="copyNequiNumber()" title="Copiar nÃºmero">ðŸ“‹</button>
            </div>

            @if (copied) {
            <p class="copiado">NÃºmero copiado âœ…</p>
            }
        </div>
    </div>
</div>
}